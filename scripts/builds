#!/usr/bin/env bash

# shellcheck disable=SC2016
echo "# auto-generated by scripts/dependabot. DO NOT EDIT.

name: build
on: [push, pull_request]

jobs:" >./.github/workflows/build.yml

find . -type f -name go.mod | while read -r mod; do
  name="$(basename "$(dirname "$mod")")"
  sum="$(dirname "$mod").sum"
  echo "  $name:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: \${{ matrix.os }}
    defaults:
      run:
        working-directory: $(dirname "$mod")
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-go@v5
        with:
          go-version-file: $mod
          cache: true
          cache-dependency-path: $sum
      - run: echo $PWD
      - run: go mod download
      - run: go build -v ./...
      - run: go test -race -v ./..." >>./.github/workflows/build.yml
done
